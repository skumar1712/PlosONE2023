% The code plots forward and backward FTLE field by reading it from .txt files
clear 

A = dlmread('C:\MATLAB\LCS-Tool-master\LMK23\FinalComputations\NewESF01\Case2\NewESF01\bFTLElen30nx401ny131t3.txt', '', 3) ;  

B = A ;

Nx = 2*200+1;
Ny = 130+1;

% Arrangning the data in Nx x Ny shape
for i = 1 : Nx
    x(:, i) = A((i-1)*Ny+1:i*Ny, 1);
    y(:, i) = A((i-1)*Ny+1:i*Ny, 2);
    f(:, i) = A((i-1)*Ny+1:i*Ny, 3);
    g(:, i) = B((i-1)*Ny+1:i*Ny, 3);
end

figure; contourf(x, y, f); colorbar
title('Forward FTLE field')
% figure; contourf(x, y, g); colorbar
title('Backward FTLE field')

% Normalizing and considering only FTLE values >=0.75

thres = 0.25 ;          % The threshold value

A1 = A ; 
rangeA = max(A(:,3)) - min(A(:,3)) ; 
A1(:,3)  = (A(:,3) - min(A(:,3))) / rangeA ;
dumA = A1(:,3) ;
dumA(dumA<thres)=0; 
A1(:,3) = dumA ; 

B1 = B; 
rangeB = max(B(:,3)) - min(B(:,3)) ; 
B1(:,3) = (B(:,3) - min(B(:,3))) / rangeB ;

dumB = B1(:,3) ;
dumB(dumB<thres)=0; 
B1(:,3) = dumB ; 

% Filtered data in Nx x Ny shape
for i = 1 : Nx
    f1(:, i) = A1((i-1)*Ny+1:i*Ny, 3);
    g1(:, i) = B1((i-1)*Ny+1:i*Ny, 3);
end

return;
figure; contourf(x, y, f1); colormap('jet'), colorbar, 
title('Forward (filtered) FTLE field')
figure; contourf(x, y, g1); colormap('jet'), colorbar
title('Backward (filtered) FTLE field')


% Base case right part 

mean_ftle_f = [1.9627    1.8347    1.7428    1.7268    1.6059    1.5119    1.4320    1.3760    1.3572    1.3584    1.3496    1.3356    1.3280  1.3200    1.3202    1.3154    1.3208] ;

% Right part:
% t \in[15, 95], Int. length=10, Interval=5, dx=dy=1e-3, Nx=Ny=90
mean_ftle_b = [1.2117    1.3289    1.3472    1.4040    1.4339    1.4098    1.4112    1.4006    1.3922    1.3768    1.3738    1.3797    1.3913  1.3923    1.4008  1.4611    1.3686] ;    

% t \in[16, 96], Int. length=10, Interval=2, dx=dy=2e-3, Nx=Ny=45
mean_ftle_b = [1.0904    1.1478    1.2164    1.2230    1.2429    1.2275    1.2401    1.2747    1.2932    1.2989    1.2716    1.2647    1.2568 1.2585    1.2466    1.2347    1.2409    1.2387    1.2270    1.2201    1.2156    1.2113    1.2037    1.1982    1.2003    1.2018 1.1993    1.2026    1.2070    1.2147    1.2155    1.2178    1.2243    1.2274    1.2312    1.2450    1.2640    1.2935    1.2410 1.2063    1.1861] ;
    
% t \in[16, 96], Int. length=10, Interval=4, dx=dy=1e-3, Nx=Ny=91
mean_ftle_b = [1.2179    1.3289    1.3458    1.3704    1.4271    1.4252    1.4098    1.4164    1.4098    1.3921    1.3920    1.3768    1.3726    1.3800    1.3867    1.3949    1.3923    1.3984    1.4357    1.4063    1.3562 ] ; 

% t \in[26, 96], Int. length=20, Interval=2, dx=dy=2e-3, Nx=Ny=45
mean_ftle_b = [0.5969    0.6112    0.6378    0.6508    0.6593    0.6426    0.6385    0.6311    0.6307    0.6250    0.6182    0.6219    0.6211 0.6154    0.6099    0.6058    0.5983    0.5913    0.5891    0.5932    0.5964    0.5983    0.6021    0.6055    0.6092    0.6084 0.6104    0.6110    0.6136    0.6172    0.6277    0.6404    0.6594    0.6327    0.6070    0.5940];

% Centeral part
% t \in[16, 96], Int. length=10, Interval=2, dx=dy=2e-3, Nx=135, Ny=75
mean_ftle_b = [ 1.2298    1.3218    1.3469    1.3001    1.2876    1.3236    1.3449    1.3024    1.2390    1.2496    1.2652    1.2737    1.2781 1.2637    1.2520    1.2539    1.2648    1.2627    1.2768    1.2783    1.2877    1.2890    1.3000    1.3104    1.3163    1.3287 1.3330    1.3485    1.3520    1.3544    1.3700    1.3704    1.3668    1.3595    1.3907    1.3673    1.3548    1.3780    1.4153 1.3761    1.3586] ; 

% Anglet Input: 
% Right part
mean_ftle_b = [1.2156    1.2045    1.2090    1.2480    1.3162    1.3997    1.4281    1.4045    1.3742    1.3384    1.3029    1.2488    1.2386 1.2275    1.2356    1.2433    1.2426    1.2671    1.2719    1.2732    1.2812    1.2753    1.2790    1.2893    1.2855    1.2864 1.2947    1.2897    1.2939    1.2940    1.2933    1.2928    1.2960    1.2968    1.2983    1.2953    1.2965    1.2975    1.3000 1.3013    1.3039]; 
% Centeral part
mean_ftle_b = [1.3644    1.3511    1.3410    1.3408    1.3666    1.3711    1.3580    1.3853    1.3973    1.3935    1.4043    1.4061    1.3974 1.3909    1.3962    1.4055    1.4115    1.4182    1.4137    1.4237    1.4194    1.4219    1.4304    1.4207    1.4195    1.4234     1.4293    1.4267    1.4346    1.4331    1.4317    1.4294    1.4310    1.4272    1.4320    1.4289    1.4262    1.4325    1.4284 1.4303    1.4330]; 

% Angled InputOutput:
% 
% Rigth part
mean_ftle_b = [ 1.1754    1.1617    1.1783    1.2031    1.2386    1.2743    1.3405    1.3792    1.3994    1.3941    1.3573    1.3032    1.2514 1.2224    1.2236    1.2483    1.2407    1.2395    1.2524    1.2706    1.2805    1.3010    1.3198    1.3209    1.3247    1.3306 1.3345    1.3322    1.3295    1.3296    1.3303    1.3308    1.3403    1.3363    1.3320    1.3373    1.3383    1.3358    1.3316 1.3344    1.3364];
% Centeral part
mean_ftle_b = [1.4455    1.4151    1.3943    1.3941    1.3914    1.3586    1.3493    1.3940    1.4206    1.4096    1.4077    1.4144    1.4227 1.4087    1.4127    1.4151    1.4245    1.4213    1.4235    1.4246    1.4290    1.4298    1.4370    1.4355    1.4381    1.4382 1.4413    1.4420    1.4423    1.4438    1.4452    1.4383    1.4436    1.4412    1.4402    1.4455    1.4448    1.4477    1.4481 1.4496    1.4530];

% Double outlet
% right part, dx=dy=1e-3
mean_ftle_b = [1.2504    1.2762    1.3549    1.3727    1.3745    1.3565    1.3838    1.4343    1.4659    1.4335    1.4460    1.4725    1.4801 1.4736    1.4721    1.4657    1.4613    1.4556    1.4424    1.4360    1.4261    1.4214    1.4118    1.4054    1.4090    1.4060 1.4046    1.4053    1.3975    1.3966    1.3984    1.3940    1.3963    1.3932    1.3934    1.3933    1.3950    1.3962    1.3973 1.3927    1.3938 ];

mean_ftle_b = [ 1.1159    1.1546    1.2355    1.2365    1.2339    1.2583    1.2718    1.3062    1.3167    1.2834    1.3056    1.3262    1.3211 1.3155    1.2989    1.3019    1.3003    1.2921    1.2745    1.2668    1.2553    1.2610    1.2592    1.2522    1.2513    1.2540 1.2469    1.2528    1.2402    1.2361    1.2374    1.2337    1.2408    1.2352    1.2270    1.2248    1.2241    1.2238    1.2271 1.2273    1.2261] ; 

%central
mean_ftle_b = [1.4096    1.5917    1.7072    1.6808    1.6284    1.5236    1.4895    1.5687    1.6417    1.5588    1.5172    1.4789    1.4920 1.5002    1.5047    1.4877    1.4357    1.4367    1.4775    1.5086    1.5080    1.4697    1.4430    1.4579    1.4938    1.5048 1.4677    1.4486    1.4460    1.4770    1.5047    1.4990    1.4794    1.4814    1.4900    1.5163    1.5296    1.5313    1.5359 1.5650    1.5915] ;

% top left
mean_ftle_b = [1.3837    1.5384    1.6277    1.6420    1.4194    1.4462    1.5319    1.5203    1.5862    1.5900    1.5343    1.5047    1.5057 1.4724    1.4919    1.4885    1.4460    1.3940    1.4346    1.4984    1.5113    1.4922    1.4396    1.4405    1.4690    1.4780 1.4729    1.4180    1.4150    1.4405    1.4556    1.4293    1.4055    1.3950    1.3949    1.3857    1.3480    1.3391    1.3126 1.3327    1.3562]; 

% top right
mean_ftle_b = [ 1.3713    1.5298    1.7304    1.6347    1.3417    1.1937    1.5010    1.8147    1.8267    1.6635    1.4383    1.3759    1.3862 1.4473    1.4280    1.3659    1.3362    1.3367    1.3917    1.3961    1.3617    1.3022    1.2674    1.3146    1.3550    1.3302 1.2582    1.1958    1.2160    1.2522    1.2530    1.2091    1.1773    1.1310    1.1699    1.1973    1.1953    1.1998    1.2188 1.2868    1.4264];
